#!/usr/bin/env python3
"""
Vulnerability Database for Common Ports
This is a basic database - in production, you'd connect to external services
"""

VULNERABILITY_DB = {
    21: {
        "service": "FTP",
        "vulnerabilities": [
            "Anonymous login enabled",
            "Weak encryption",
            "Buffer overflow in vsFTPd 2.3.4"
        ],
        "checks": ["check_ftp_auth", "check_ftp_version"]
    },
    22: {
        "service": "SSH",
        "vulnerabilities": [
            "Weak SSH protocol version (SSHv1)",
            "Default credentials",
            "Known vulnerable versions (OpenSSH < 7.6)"
        ],
        "checks": ["check_ssh_version", "check_ssh_auth"]
    },
    23: {
        "service": "Telnet",
        "vulnerabilities": [
            "Clear text communication",
            "No authentication",
            "Buffer overflow vulnerabilities"
        ],
        "checks": ["check_telnet_auth"]
    },
    25: {
        "service": "SMTP",
        "vulnerabilities": [
            "Open relay configuration",
            "Version disclosure",
            "SPF/DKIM misconfiguration"
        ],
        "checks": ["check_smtp_relay", "check_smtp_version"]
    },
    80: {
        "service": "HTTP",
        "vulnerabilities": [
            "Directory traversal",
            "SQL injection",
            "XSS vulnerabilities",
            "Outdated server software"
        ],
        "checks": ["check_http_headers", "check_common_web_vulns"]
    },
    443: {
        "service": "HTTPS",
        "vulnerabilities": [
            "SSL/TLS vulnerabilities (Heartbleed, POODLE)",
            "Weak cipher suites",
            "Expired certificates"
        ],
        "checks": ["check_ssl_tls", "check_certificate"]
    },
    139: {
        "service": "NetBIOS",
        "vulnerabilities": [
            "SMB vulnerabilities (EternalBlue)",
            "Null session access",
            "Information disclosure"
        ],
        "checks": ["check_smb_vulnerabilities"]
    },
    445: {
        "service": "SMB",
        "vulnerabilities": [
            "EternalBlue vulnerability (MS17-010)",
            "SMBv1 protocol",
            "Unauthenticated access"
        ],
        "checks": ["check_eternalblue", "check_smb_version"]
    },
    3306: {
        "service": "MySQL",
        "vulnerabilities": [
            "Default credentials (root:root)",
            "Unauthenticated access",
            "Outdated MySQL versions"
        ],
        "checks": ["check_mysql_auth"]
    },
    3389: {
        "service": "RDP",
        "vulnerabilities": [
            "BlueKeep vulnerability (CVE-2019-0708)",
            "Weak encryption",
            "Brute force vulnerabilities"
        ],
        "checks": ["check_rdp_vulnerabilities"]
    },
    8080: {
        "service": "HTTP-Proxy",
        "vulnerabilities": [
            "Default credentials",
            "Proxy misconfiguration",
            "Unauthenticated access"
        ],
        "checks": ["check_proxy_auth"]
    }
}

# Common vulnerable banners
VULNERABLE_BANNERS = {
    "vsftpd 2.3.4": ["vsFTPd 2.3.4 backdoor vulnerability"],
    "OpenSSH 7.5": ["CVE-2018-15473", "User enumeration vulnerability"],
    "Apache 2.4.49": ["CVE-2021-41773", "Path traversal vulnerability"],
    "ProFTPD 1.3.5": ["Remote command execution vulnerability"]
}

def get_vulnerabilities(port, banner=""):
    """
    Get vulnerabilities for a specific port and banner
    """
    vulns = []
    
    # Check port-specific vulnerabilities
    if port in VULNERABILITY_DB:
        vulns.extend(VULNERABILITY_DB[port]["vulnerabilities"])
    
    # Check banner-specific vulnerabilities
    for vulnerable_banner, banner_vulns in VULNERABLE_BANNERS.items():
        if vulnerable_banner.lower() in banner.lower():
            vulns.extend(banner_vulns)
    
    return list(set(vulns))  # Remove duplicates

def get_service_name(port):
    """
    Get service name for port
    """
    if port in VULNERABILITY_DB:
        return VULNERABILITY_DB[port]["service"]
    return "Unknown"